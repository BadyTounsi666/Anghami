const ipcRenderer=require("electron").ipcRenderer;let isMiniPlayer,queue="",currentTrack="",currentOptions="",dragging=!1,playingStatus=!1,bufferingStatus=!1,language="";function setupEventListeners(){document.getElementById("play-button").addEventListener("click",emitPlayEvent),document.getElementById("next-button").addEventListener("click",emitNextEvent),document.getElementById("previous-button").addEventListener("click",emitPreviousEvent),document.getElementById("repeat-button").addEventListener("click",emitRepeatEvent),document.getElementById("shuffle-button").addEventListener("click",emitShuffleEvent),document.getElementById("progress-full").addEventListener("click",seekToPosition),document.getElementById("progress-current").addEventListener("click",seekToPosition),document.getElementById("minimize-button").addEventListener("click",minimizeMiniPlayer),document.getElementById("close-button").addEventListener("click",closeMiniPlayer),document.getElementById("like-button").addEventListener("click",emitLikeEvent),window.addEventListener("keyup",function(e){"Space"==e.code?emitPlayEvent():"ArrowLeft"==e.code?emitPreviousEvent():"ArrowRight"==e.code&&emitNextEvent()}),window.addEventListener("keydown",function(e){"Space"==e.code&&e.target==document.body&&e.preventDefault()}),setupSeekbarEvents()}function setupSeekbarEvents(){document.getElementById("progress-current").style.transform="scaleX(0) translateY(-5px)",document.getElementById("progress-handle").style.transform="translateX(-6px) translateY(-28px)",document.getElementById("progress-handle-under").style.transform="translateX(-6px) translateY(-14px)",shared={},document.getElementById("progress-handle").addEventListener("dragstart",function(e){dragging=!0,shared.initialWidth=new WebKitCSSMatrix(document.getElementById("progress-current").style.transform).m11,shared.progressWidth=document.getElementById("progress-full").offsetWidth,document.getElementById("progress-handle").style.opacity="0"}),document.getElementById("progress-handle").addEventListener("drag",function(e){currentScaleX="ar"==language?shared.initialWidth-e.offsetX/shared.progressWidth:shared.initialWidth+e.offsetX/shared.progressWidth,currentScaleX>1?currentScaleX=1:currentScaleX<0&&(currentScaleX=0),document.getElementById("progress-current").style.transform="scaleX("+currentScaleX+") translateY(-5px)","ar"==language&&(currentScaleX=1-currentScaleX),document.getElementById("progress-handle-under").style.transform="translateX(calc(((100vw - 40px) * "+currentScaleX+") - 6px)) translateY(-14px)"}),document.getElementById("progress-handle").addEventListener("dragend",function(e){currentScaleX="ar"==language?shared.initialWidth-e.offsetX/shared.progressWidth:shared.initialWidth+e.offsetX/shared.progressWidth,currentScaleX>1?currentScaleX=1:currentScaleX<0&&(currentScaleX=0),document.getElementById("progress-current").style.transform="scaleX("+currentScaleX+") translateY(-5px)","ar"==language&&(currentScaleX=1-currentScaleX),document.getElementById("progress-handle-under").style.transform="translateX(calc(((100vw - 40px) * "+currentScaleX+") - 6px)) translateY(-14px)",document.getElementById("progress-handle").style.transform="translateX(calc(((100vw - 40px) * "+currentScaleX+") - 6px)) translateY(-28px)",document.getElementById("progress-handle").style.opacity="1","ar"==language&&(currentScaleX=1-currentScaleX),emitSeekEvent(100*currentScaleX),dragging=!1})}function emitPlayEvent(){ipcRenderer.send("tray-message",{action:"player-action",playeraction:"playpause"})}function emitNextEvent(){ipcRenderer.send("tray-message",{action:"player-action",playeraction:"next"})}function emitPreviousEvent(){ipcRenderer.send("tray-message",{action:"player-action",playeraction:"previous"})}function emitRepeatEvent(){ipcRenderer.send("tray-message",{action:"player-action",playeraction:"repeat"})}function emitShuffleEvent(){ipcRenderer.send("tray-message",{action:"player-action",playeraction:"shuffle"})}function emitPlayTrackEvent(e){ipcRenderer.send("tray-message",{action:"play-track",payload:{index:Array.from(e.target.parentElement.parentNode.children).indexOf(e.target.parentElement)}})}function emitSeekEvent(e){ipcRenderer.send("tray-message",{action:"seek",percentage:e})}function emitLikeEvent(){ipcRenderer.send("tray-message",{action:"like-track",payload:{track:currentTrack,isVideo:currentOptions.video}})}function minimizeMiniPlayer(){ipcRenderer.send("tray-message",{action:"miniplayer-minimize"})}function closeMiniPlayer(){ipcRenderer.send("tray-message",{action:"miniplayer-close"})}function seekToPosition(e){percentage=(e.clientX-20)/document.getElementById("progress-full").offsetWidth*100,"ar"==language&&(percentage=(document.getElementById("progress-full").offsetWidth-e.clientX+20)/document.getElementById("progress-full").offsetWidth*100),percentage<0?percentage=0:percentage>100&&(percentage=100),emitSeekEvent(percentage)}function styleCurrent(){var e=document.getElementById(currentTrack.id);e&&e.classList.add("item-playing")}function playingIndicator(){var e=document.getElementsByClassName("item-playing-indicator");for(song of e)song.classList.remove("item-playing-indicator");(e=document.getElementById(currentTrack.id))&&!bufferingStatus&&playingStatus&&e.classList.add("item-playing-indicator")}function scrollToCurrent(){var e=document.getElementById(currentTrack.id);e&&(e.classList.add("item-playing"),e.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}))}function fillQueue(){if(""!=queue)for(track of(document.getElementById("queue-container").innerHTML="",queue.data)){var e=document.createElement("div");e.setAttribute("class","item"),e.setAttribute("id",track.id);var t=document.createElement("div");t.setAttribute("class","item-thumb"),t.style.backgroundImage='url("'+track.coverArtImageSmall+'")';var r=document.createElement("div");r.setAttribute("class","item-info");var n=document.createElement("p");n.setAttribute("class","item-title"),n.appendChild(document.createTextNode(track.title));var a=document.createElement("p");a.setAttribute("class","item-artist"),a.appendChild(document.createTextNode(track.artist)),r.appendChild(n),r.appendChild(a),e.appendChild(t),e.appendChild(r),e.addEventListener("click",emitPlayTrackEvent),document.getElementById("queue-container").appendChild(e)}}ipcRenderer.on("tray-position",(e,t)=>{t.isMiniPlayer?(isMiniPlayer=!0,document.getElementById("anghami-logo-container").classList.add("draggable"),document.getElementById("current-track").classList.add("draggable"),document.getElementById("minimize-button").classList.remove("hidden"),document.getElementById("tray-arrow-top").classList.add("hidden"),document.getElementById("tray-arrow-bottom").classList.add("hidden")):(isMiniPlayer=!1,document.getElementById("anghami-logo-container").classList.remove("draggable"),document.getElementById("current-track").classList.remove("draggable"),document.getElementById("minimize-button").classList.add("hidden"),1==t.showArrow?"top"==t.side?(document.getElementById("tray-arrow-bottom").classList.add("hidden"),document.getElementById("tray-arrow-top").classList.remove("hidden")):"bottom"==t.side&&(document.getElementById("tray-arrow-top").classList.add("hidden"),document.getElementById("tray-arrow-bottom").classList.remove("hidden")):(document.getElementById("tray-arrow-top").classList.add("hidden"),document.getElementById("tray-arrow-bottom").classList.add("hidden"))),setTimeout(()=>{playingIndicator(),scrollToCurrent()},50)}),ipcRenderer.on("tray-theme",(e,t)=>{var r=document.documentElement.style;"dark"==t.theme?(r.setProperty("--main-color","#282828"),r.setProperty("--primary-text-color","#e8e8e8"),r.setProperty("--secondary-text-color","#919191"),r.setProperty("--button-icon-color","#000"),r.setProperty("--player-separator","#424242"),r.setProperty("--liked-icon-color","#e8e8e8"),r.setProperty("--queue-area-color","#323232"),r.setProperty("--queue-item-border-color","#323232"),r.setProperty("--queue-item-background-color","#4A4A4A"),r.setProperty("--queue-thumb-background-color","#606060"),r.setProperty("--scrollbar-track-color","#262626"),r.setProperty("--scrollbar-thumb-color","#5d5d5d"),r.setProperty("--brand-logo","url(../../icons/anghami-logo-white.png)")):(r.setProperty("--main-color","#fff"),r.setProperty("--primary-text-color","#000"),r.setProperty("--secondary-text-color","#000"),r.setProperty("--button-icon-color","#e1e1e1"),r.setProperty("--player-separator","#eff3f5"),r.setProperty("--liked-icon-color","#8d00f2"),r.setProperty("--queue-area-color","#f4f4f4"),r.setProperty("--queue-item-border-color","#f3f5f7"),r.setProperty("--queue-item-background-color","#d8d8d8"),r.setProperty("--queue-thumb-background-color","#d2d6d8"),r.setProperty("--scrollbar-track-color","#d8d8d8"),r.setProperty("--scrollbar-thumb-color","#b1b1b1"),r.setProperty("--brand-logo","url(../../icons/anghami-logo-colored.png)"))}),ipcRenderer.on("tray-language",(e,t)=>{"ar"==(language=t.language)?(document.documentElement.lang="ar",document.getElementById("queue-title").innerHTML="في القائمة"):"fr"==language?(document.documentElement.lang="fr",document.getElementById("queue-title").innerHTML="Dans la file"):(document.documentElement.lang="en",document.getElementById("queue-title").innerHTML="In Queue")}),ipcRenderer.on("tray-current-options",(e,t)=>{t.currentOptions&&(playingStatus=t.currentOptions.playing,bufferingStatus=t.currentOptions.buffering,t.currentOptions.buffering?(document.getElementById("play-icon").classList.add("hidden"),document.getElementById("pause-icon").classList.add("hidden"),document.getElementById("loading").classList.remove("hidden")):t.currentOptions.playing?(document.getElementById("play-icon").classList.add("hidden"),document.getElementById("pause-icon").classList.remove("hidden"),document.getElementById("loading").classList.add("hidden")):(document.getElementById("play-icon").classList.remove("hidden"),document.getElementById("pause-icon").classList.add("hidden"),document.getElementById("loading").classList.add("hidden")),styleCurrent(),playingIndicator(),t.currentOptions.shuffle?document.getElementById("shuffle-button").classList.add("active-shuffle-repeat"):document.getElementById("shuffle-button").classList.remove("active-shuffle-repeat"),t.currentOptions.repeat?document.getElementById("repeat-button").classList.add("active-shuffle-repeat"):document.getElementById("repeat-button").classList.remove("active-shuffle-repeat"),currentOptions=t.currentOptions)}),ipcRenderer.on("tray-current-track",(e,t)=>{if(t.currentTrack){if(document.getElementById("current-track-title").innerHTML=t.currentTrack.title?t.currentTrack.title:"",document.getElementById("current-track-artist").innerHTML=t.currentTrack.artist?t.currentTrack.artist:"",document.getElementById("current-track-coverart").style.backgroundImage='url("'+t.currentTrack.coverArtImage+'")',document.getElementsByTagName("title")[0].innerHTML=t.currentTrack.title+" - "+t.currentTrack.artist,t.currentTrack.liked?(document.getElementById("like-icon").classList.add("hidden"),document.getElementById("liked-icon").classList.remove("hidden")):(document.getElementById("like-icon").classList.remove("hidden"),document.getElementById("liked-icon").classList.add("hidden")),trackChanged=currentTrack.id!=t.currentTrack.id,trackChanged){var r=document.getElementsByClassName("item-playing");for(song of r)song.classList.remove("item-playing")}currentTrack=t.currentTrack,trackChanged&&styleCurrent(),t.currentTrack.title?ipcRenderer.send("trayReady",{trayReady:!0}):ipcRenderer.send("trayReady",{trayReady:!1})}}),ipcRenderer.on("tray-current-queue",(e,t)=>{var r=!1;if(queue&&t.currentQueue)if(queue.data.length==t.currentQueue.data.length){if(!queue.data[0].coverArtImageSmall&&t.currentQueue.data[0].coverArtImageSmall)r=!0;else for(const[e,n]of queue.data.entries())if(n.id!=t.currentQueue.data[e].id){r=!0;break}}else r=!0;else r=!0;r&&(queue=t.currentQueue,fillQueue().then(()=>{playingIndicator(),scrollToCurrent()}))}),ipcRenderer.on("tray-current-progress",(e,t)=>{t.progress.seconds&&t.progress.duration?"ar"==language?(document.getElementById("elapsed-time").innerHTML=t.progress.duration,document.getElementById("total-time").innerHTML=" / "+t.progress.seconds):(document.getElementById("elapsed-time").innerHTML=t.progress.seconds+" / ",document.getElementById("total-time").innerHTML=t.progress.duration):(document.getElementById("elapsed-time").innerHTML="",document.getElementById("total-time").innerHTML=""),dragging||(currentScaleX=t.progress.percentage/100,document.getElementById("progress-current").style.transform="scaleX("+currentScaleX+") translateY(-5px)","ar"==language&&(currentScaleX=1-currentScaleX),document.getElementById("progress-handle").style.transform="translateX(calc(((100vw - 40px) * "+currentScaleX+") - 6px)) translateY(-28px)",document.getElementById("progress-handle-under").style.transform="translateX(calc(((100vw - 40px) * "+currentScaleX+") - 6px)) translateY(-14px)")}),document.addEventListener("DOMContentLoaded",setupEventListeners,!1);